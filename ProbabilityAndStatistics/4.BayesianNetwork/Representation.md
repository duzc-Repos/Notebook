## 2.4 贝叶斯网的构造

* 咨询专家**手工构造**（本节重点）
* 通过数据获得（第三部分，利用机器学习分析数据获得贝叶斯网）



### 2.4.1 确定网络结构

* 一般性方法：
  * 选定一组刻画问题的随机变量$\{X_1, \cdots, X_n\}$
  * 选择一个添加变量的顺序$a = <X_1, \cdots, X_n>$
  * 从空图出发，按照顺序$a$逐个将变量加入图$G$中
    * 选定尽可能小的子集${\rm pa}(X_i)$，使得条件独立成立
    * 从${\rm pa}(X_i)$中的每个结点添加一条指向$X_i$的边

* 存在的问题：不同添加变量的顺序会产生不同的变量结构，从而产生不同复杂度的模型
* 解决方案：
  * Smith（1989）：应该以**模型复杂度**为标准，选最简单的模型
  * Howard & Matheson（1984）：应该以**条件概率评估的难易**程度
  * Pearl（2000）：应该用**因果关系**来决定变量顺序。在实际应用中，因果关系往往使网络结构变得简单



### 2.4.3 确定网络参数

* 一般方法：
  * 一般通过数据分析获得
  * 有时也可以从问题的特性获得
    * 基因遗传问题$P(G_{child} \mid G_{father}, G_{mother})$: 孟德尔随即遗传假设
    * 信道编码

* 尽量减少参数的方法：（假设某种局部结构）
  * 因果独立机制（causal independence）：多个原因独立的影响一个结果
  * 环境独立（context specifix independence）：特定环境下，条件独立成立
    * 环境（context）：一组变量及其取值的组合
    * e.g. 在环境$C=c$中，$X, Y$在给定$Z$时独立，即$P(X \mid Z, Y, C=c) = P(X \mid Z, C=c)$



# 第三章 图分隔与变量独立

## 3.2 D-seperation and conditional indenpendence

* 一些定义

  * 祖先闭集：一个结点集合内任意节点的祖先都在该集合内
  * 最小祖先闭集
  * 马尔科夫边界/马尔可夫毯${\rm mb}(X)$: 父节点、子节点，以及子节点的父节点

* 几个引理：

  * **引理1**：记贝叶斯网为$G$, 所有结点的集合为$S = \{X, Y\}$, 其中$Y$是一个叶节点，则$P_{S}(X) = P_X(X)$。

    * 即从图中去除叶节点不会影响其他结点的联合分布

      >证明：
      >$$
      >\begin{aligned}
      >P_S(X) & = \sum_\limits{Y}P_S(X, Y) \\
      >       &= \sum_\limits{Y} \prod_\limits{x \in X} P(x \mid {\rm pa}(x))P(Y \mid {\rm pa}(Y)) \ \ \ \ ({\rm product\ rules}) \\
      >       &= \prod_\limits{x \in X} P(x \mid {\rm pa}(x)) \sum_\limits{Y} P(Y \mid {\rm pa}(Y)) \ \ \ \ (Y是叶结点)  \\
      >       &= \prod_\limits{x \in X} P(x \mid {\rm pa}(x)) \\
      >       &= P_X(X)
      >
      >\end{aligned}
      >$$

  * **引理2**：若$X$是一个祖先闭集，且$X$之外有节点存在，则一定存在叶结点

  * **命题1**：若$X$是一个祖先闭集，则从图中去除任意不属于$X$的结点不影响$X$的分布函数

  * **命题2**：$X, Y, Z$为两两不交的集合，并集为全集，则$Z$D-分割$X, Y \iff X \perp Y \mid Z$

  * **整体马尔可夫性**：$Z$不包含$X, Y$中的结点，则$Z$D-分割$X, Y \iff X \perp Y \mid Z$
    $$
    D{\rm-}spereration \iff X \perp Y \mid Z
    $$

    * **推论1**：$\neg X \perp X \mid {\rm mb}(X)$
    * **推论2（局部马尔可夫性）**：$\neg {\rm child}(X) \perp X \mid {\rm pa}(X)$
    * **因果马尔可夫假设**：给定变量的直接原因，该变量条件独立与所有那些不是它的直接或间接结果



## 3.3 有向分割与无向分割

* 一些定义：

  * **端正图**（moral graph）: 去点所有边的方向，在所有结点的父节点之间连一条边所形成的图为端正图
    * 该过程为端正化（moralization）
    * 端正图是一个无向有环图
  * 结点集合$Y$的**限制**$G_Y$：去除所有不在$Y$的结点以及与$Y$相连的边所得到的图

  * 无向图的**通路**：结点序列，相邻结点在图上直接有边相连
  * **无向分隔/u-分隔**：在无向图中，$Z$阻断了所有$X$到$Y$的通路

* 定理：

  * **有向分割（d-分割）与无向分割（u-分割）的关系**：$X, Y, Z$为两两不交的结点集合，$(G_{an\{X \cup Y \cup Z \}})^m$表示限制在$X, Y, Z$祖先闭集上的图并进行端正化，则有
    $$
    d-分隔 \iff u-分隔
    $$

## 3.4 有向无圈图与联合概率分布

* 贝叶斯网的图论侧面：d-分隔
* 贝叶斯网的概率论侧面：条件独立性

* 一些记号：
  * $V, X, Y, Z$: 随机变量集合，$V$所有随机变量集合，$X, Y, Z$为两两不交的随机变量集合
  * $P$: $V$的联合概率分布
  * $X \perp_P Y \mid Z$: 在连个概率$P$中，给定$Z$，$X, Y$相互独立
  * $S_G(X, Y, Z)$: 在图$G$中，Z d-分隔$X, Y$

* 利用有向无圈图$G$可以定义关于联合概率分布$P$的性质：
  * (1) $P$是$G$**可分解**的：即如果存在一个以$G$为结构的贝叶斯网络，则其联合分布正好是$P$
  * (2) $P$具有**整体马尔可夫性**：$S_G(X, Y, Z) \Rightarrow X \perp_P Y \mid Z$
  * (3) $P$具有**局部马尔可夫性**：$X \perp_P \neg {\rm child}(X) \mid {\rm pa}_G(X)$
  * **定理**：(1) $\iff$ (2) $\iff$ (3)

* 利用联合概率分布$P$可以定义关于有向无圈图$G$的两个性质:
  * $G$是$P$的独立图（indenpendence map, I-map）: $S_G(X, Y, Z) \Rightarrow X \perp_P Y \mid Z$
    * **d-分隔** 推出 **全局马尔科夫性**，表示$P$中的独立关系
    * 独立图$G$中蕴含的条件独立是$P$中所有独立关系的一个子集
    * 独立图中加边仍然是独立图
    * $P$是G可分解的
  * $G$是$P$的依赖图（denpendence map, D-map）：$X \perp_P Y \mid Z \Rightarrow S_G(X, Y, Z)$
    * **全局马尔科夫性** 推出 **d-分隔**，表示$P$中的依赖关系
    * $P$中条件独立是依赖图$G$中的一个子集
  * 既是I-map又是D-map $\Rightarrow$ 完美图（Perfect map, P-map）
  * 独立图中加边仍然是独立图，依赖图去掉一条边仍然是依赖图
  * 最小独立图（minimal I-map）：去掉一条边就不是独立图了







